<?xml version="1.0"?>
<clickhouse>
    <!-- ClickHouse Keeper Client Configuration - Minimal and Essential -->
    
    <!-- ZooKeeper/Keeper Client Configuration -->
    <!-- How ClickHouse connects to Keeper servers -->
    <zookeeper>
        <!-- Basic connection settings -->
        <session_timeout_ms>30000</session_timeout_ms>
        <operation_timeout_ms>10000</operation_timeout_ms>
        <root>/clickhouse</root>
        
        <!-- Keeper server nodes -->
        <node>
            <host>keeper-1</host>
            <port>2181</port>
        </node>
        <node>
            <host>keeper-2</host>
            <port>2181</port>
        </node>
        <node>
            <host>keeper-3</host>
            <port>2181</port>
        </node>
        
        <!-- SSL settings for secure communication -->
        <use_ssl>true</use_ssl>
        <ssl_cert_file>/etc/ssl/clickhouse/clickhouse-server.crt</ssl_cert_file>
        <ssl_key_file>/etc/ssl/clickhouse/clickhouse-server.key</ssl_key_file>
        <ssl_ca_cert_file>/etc/ssl/clickhouse/ca.crt</ssl_ca_cert_file>
        <ssl_verify_mode>strict</ssl_verify_mode>
        
        <!-- Connection optimization -->
        <prefer_local_keeper_connection>true</prefer_local_keeper_connection>
    </zookeeper>

    <!-- Distributed DDL Configuration (Essential for cluster operations) -->
    <distributed_ddl>
        <path>/clickhouse/task_queue/ddl</path>
        <profile>default</profile>
    </distributed_ddl>

    <!-- Remote Servers Configuration (1 shard, 3 replicas) -->
    <remote_servers>
        <${CLUSTER_NAME}>
            <shard>
                <replica>
                    <host>${INTERSERVER_HOST}</host>
                    <port>9002</port>
                    <user>interserver</user>
                    <secure>1</secure>
                </replica>
                <replica>
                    <host>${INTERSERVER_HOST}</host>
                    <port>9002</port>
                    <user>interserver</user>
                    <secure>1</secure>
                </replica>
                <replica>
                    <host>${INTERSERVER_HOST}</host>
                    <port>9002</port>
                    <user>interserver</user>
                    <secure>1</secure>
                </replica>
            </shard>
        </${CLUSTER_NAME}>
    </remote_servers>

    <!-- Macros for ReplicatedMergeTree tables -->
    <macros>
        <cluster>${CLUSTER_NAME}</cluster>
        <shard>01</shard>
        <replica>${INSTANCE_NAME}</replica>
    </macros>

</clickhouse>